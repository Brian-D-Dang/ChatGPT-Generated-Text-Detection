They don't determine it for all foods, but rather for the individual ingredients. For each ingredient, they pick a bunch of samples, test them, and figure the average amount of each material in the sample. Then, when you make something with that ingredient, you only need to figure out how much ingredient is in each serving. So, given a simple ingredient, how do they figure out it's contents... There are a variety of chemical tests. Today, mostly they freeze the sample down using liquid nitrogen and grind it into a super-fine powder. To determine how much nitrogen is in it, they use a chemical technique called Kjeldahl analysis which tells you how much nitrogen is in the sample. That's proportional to the amount of amino acids, meaning you can figure rout how much protein was in the sample - and they look up on a table (calculated 100 years ago) how many calories there are per unit of protein (originally figured out in a calorimeter by burning proteins). For fats, there are similar methods (using hexane instead of an acid to separate it out), and the fats have a known caloric content too. Everything left-over, calorically, is carbohydrate - again, they look on a chart to see how much a carbohydrate is worth. There are a battery of tests for the presence of various vitamins and minerals. Some involve chromatography (separating the chemicals out by how they move along a film, through a chemical gradient, or by size of the molecule). Some can be done by mass spectroscopy (vaporize a sample and hurl the atoms down a tube where magnets deflect the atoms based on mass and electrostatic charge)... The key, though, is that it's really expensive to do all of these chemical tests. So, rather than do them over and over, one does it to each ingredient in the product, and you fetch the values for each ingredient in a database and work out how much of ingredient you used and calculate out the calories, fats, carbs, protein, etc. that way. Necessarily, it's a gross approximation: not all fruit has the same sugar content, grains very in how much fiber vs. starch they have, but the expectation is that in the long run, the numbers on the package represent the average nutritional content one would find given the ingredients used.